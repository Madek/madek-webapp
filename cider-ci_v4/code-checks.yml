# Code Checks

contexts:

  "Git sanity checks (fixed state)":
    task_defaults:
      max_trials: 1
      traits:
        git: yes

    tasks:

      git-log-debug:
        name: 'Git: Log (for debug)'
        scripts: {test: {body: "git log -n5"}}

      linear-history:
        name: 'Git: Linear History'
        scripts:
          test:
            body: cider-ci/bin/check-if-linear-history


  "Ruby Lint":

    include: cider-ci_v4/job_components/ruby-setup.yml
    tasks:

      code-complexity-flog:
        name: "Ruby: Code complexity with flog"
        scripts:
          test:
            body: |
              set -eux
              export PATH=~/.rubies/$RUBY/bin:$PATH
              bundle exec cider-ci_flog -m app/

      code-similarity:
        name: "Ruby: Code similarity with flay"
        scripts:
          test:
            body: |
              set -eux
              export PATH=~/.rubies/$RUBY/bin:$PATH
              bundle exec cider-ci_flay -m 78 app/
    # FIXME: set to 26 again after cleanup  â†‘  <https://www.pivotaltracker.com/story/show/119127755>

      lint-ruby:
        name: "Ruby: Lint/Stylecheck with Rubocop"
        scripts:
          test:
            body: |
              set -eux
              export PATH=~/.rubies/$RUBY/bin:$PATH
              bundle exec rubocop


  "JavaScript Lint":

    task_defaults:
      traits:
        nodejs: yes
      # en lieu of 'npm install':
      git_options:
        submodules:
          include_match: ^.*$

    tasks:

      lint-coffee-and-javascript:
        name: 'JS: Lint/Stylecheck with `standard` and Coffeelint'
        scripts:
          test:
            body: npm run lint
