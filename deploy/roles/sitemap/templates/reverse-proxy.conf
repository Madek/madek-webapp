# Managed with ansible


###############################################################################
### General apache config #####################################################
###############################################################################

# exclude some files from reverse proxying

# ProxyPass /favicon.ico !
# ProxyPass /robots.txt !
# ProxyPass /favicon.ico !
# ProxyPass        /sitemaps !
# ProxyPassReverse /sitemaps !
#
# DocumentRoot /var/www/madek
# <Directory /var/www/madek >
#   Require all granted
# </Directory>
#
# <Directory /var/www/madek/sitemaps>
#     Options -Indexes +FollowSymLinks
#     AllowOverride None
#     Require all granted
# </Directory>

<Directory /madek/server/webapp/public/sitemaps>
    Options FollowSymLinks
    Require all granted
</Directory>

AllowEncodedSlashes NoDecode
RewriteEngine on
ProxyAddHeaders On

# some get requests require longer parameters, apache 2.4 default is 8192
LimitRequestLine 32760
LimitRequestFieldSize 32768

###############################################################################
### CORS ######################################################################
###############################################################################


# {% if reverse_proxy_enable_cors %}
#
# # CORS is enabled, set 'reverse_proxy_enable_cors' to false to change this
#
# RewriteEngine On
#
# Header always set Access-Control-Allow-Origin "*"
# Header always set Access-Control-Allow-Headers "Authorization"
# Header always set Access-Control-Allow-Methods "GET"
# Header always set Access-Control-Expose-Headers "Content-Security-Policy, Location"
# Header always set Access-Control-Max-Age "600"
#
# RewriteCond %{REQUEST_METHOD} OPTIONS
# RewriteRule ^(.*)$ $1 [R=200,L]
#
#
# {% else %}
#
# # CORS is disabled, set 'reverse_proxy_enable_cors' to change this
#
# {% endif %}
#
#
#
# ###############################################################################
# ### XSendFile #################################################################
# ###############################################################################
#
# XSendFile on
# XSendFilePath {{madek_file_storage_dir}}
# XSendFilePath {{madek_thumbnail_storage_dir}}
#
#
#
#
# ###############################################################################
# ### Cache #####################################################################
# ###############################################################################
#
# # DiskCache
#
# # CacheRoot seems to be very sensitive in debian
# #
# # /tmp works accoding log and headers but I could never locate the
# # cahed files in /tmp
# #
# # /var/cache/apache2/mod_cache_disk is the debian default and seems to work
#
#
#
# #CacheRoot   "/tmp"
# CacheRoot /var/cache/apache2/mod_cache_disk
#
#
# CacheEnable disk "/"
CacheDisable "/sitemaps"
# CacheDirLevels 2
# CacheDirLength 1
#
# # in Memory cache
# #CacheSocache shmcb
# #CacheSocacheMaxSize 9999999
#
#
# # TODO check how large are files really
# CacheMaxFileSize 50000000
# # CacheKeyBaseURL "http://madek/"
# CacheMinExpire 3600
#
# CacheQuickHandler on
# CacheHeader on
# CacheDetailHeader on
#
# CacheIgnoreHeaders Set-Cookie Cookie Cookie2 X-Forwarded-For X-Forwarded-Host
#
# <DirectoryMatch ".*/sitemaps/">
#     <FilesMatch "\.(xml|xml\.gz)$">
#         Header set Cache-Control "public, max-age=86400"
#         Header unset Pragma
#         Header set Expires "access plus 24 hours"
#     </FilesMatch>
# </DirectoryMatch>
#
#
# ###############################################################################
# ## block particular user agents ###############################################
# ###############################################################################
#
# # block bad bots
# {% for useragent in madek_block_useragents %}
# <If "%{HTTP_USER_AGENT} =~ /{{ useragent }}/">
#     Require all denied
# </If>
# {% endfor %}
#
#
#
# ###############################################################################
# ## logging ####################################################################
# ###############################################################################
#
# RequestHeader set http-uid %{UNIQUE_ID}e
#
# {% if reverse_proxy_ip_hash_seed %}
# Define IP_HASH_SEED "{{ reverse_proxy_ip_hash_seed }}"
# {% else %}
# Define IP_HASH_SEED "{{ansible_machine_id}}"
# {% endif %}
#
# {% if reverse_proxy_use_x_forwarded_for %}
# # sets %a etc with remote address forwarded by the reverse proxy
# RemoteIPHeader X-Forwarded-For
# {% endif %}
#
# SetEnvIfExpr "md5(%{REMOTE_ADDR}.'${IP_HASH_SEED}') =~ /(.{10})$/" REMOTE_IPHASH=$1
#
#
# LogFormat "%a %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\" \"%{http-uid}i\" %{REMOTE_IPHASH}e" custom-access
#
#
# # the log files are set on a per virtual host basis
#
#

# vim: syntax=apache
