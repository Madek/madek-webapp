<% can_edit = Permission.authorized?(current_user, :edit, @media_set) %>
	
<%= content_tag :div, :class => "grid_8" do
	a = content_tag :h3 do
		b = _("Set Inhalt").html_safe
		b += tag :br
		b += tag :br
	end
	
	a += media_set_title(@media_set, @media_entries) 
	
    a += unless @media_entries.empty?
		b = render :partial => '/media_entries/index'
		b += content_tag :div, :id => "droppable_remove_entry_from_media_set", :style => "border: 1px dashed black; text-align: center; font-size: 1.4em; padding: 1.5em; margin: 1em 0;" do
			_("Hierher ziehen und loslassen, um aus dem Set zu entfernen")
		end if can_edit
		b
    else
	  content_tag :h1, :style => "margin: 1em 1em;" do
      	_("Keine Medieneinträge vorhanden")
	  end
    end

# temp position replacement of permissions block
	a += content_tag :div, :class => "sidebar-box", :style => "margin-top: 1em;" do
		b = content_tag :h3 do
			_("Zugriffsberechtigungen")
		end 
		@resource = @media_set
		b += if Permission.authorized?(current_user, :manage, @media_set)
			content_tag :div do
				render :partial => "/permissions/edit_multiple"
			end
		else
			render :partial => "/permissions/index"
		end
	end

end %>

<%= content_tag :div, :class => "grid_4" do
	a = "".html_safe
	if can_edit
		a += link_to _("Metadaten editieren"), edit_media_set_path(@media_set), :class => "buttons"
		a += link_to _("Set löschen"), media_set_path(@media_set), :class => "buttons", :method => :delete, :confirm => _("Sind Sie sicher? Das Set wird gelöscht.")
		a += tag :br
		a += tag :br
	end
	a += content_tag :div, :id => "detail-excerpt", :class => "sidebar-box" do
		context = MetaContext.media_set
		@media_set.meta_data_for_context(context).collect do |meta_datum|
			# next unless meta_datum.value
			definition = meta_datum.meta_key.meta_key_definitions.for_context(context)
			b = content_tag :h4, :style => "margin-top: 1em;" do
				definition.meta_field.label.to_s
			end
			b += render :partial => "/meta_data/show", :locals => { :meta_datum => meta_datum, :resource => @media_set, :context => context }
		end.compact.join.html_safe
	end

# temp position replacement of permissions block

end %>


<%= javascript_tag do %>
	$(document).ready(function () {
		$('ul.items li').draggable({ revert: true, distance: 20, scroll: true });

    	$("#droppable_remove_entry_from_media_set").droppable({
			tolerance: 'touch',
      		drop: function(evt, props) { 
					$.ajax({ 	url: "/media_sets/<%= @media_set.id %>/media_entries/"+props.draggable.attr("media_entry_id")+"/media_sets",
								type: 'DELETE',
								beforeSend: function(){
									$(props.draggable).hide();
								},
								error: function(){
									$(props.draggable).show();
								},
								success: function(){
									$(props.draggable).remove();
								}
							});
					}
    	});
	});
<% end if can_edit %>
