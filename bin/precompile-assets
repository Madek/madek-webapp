#!/usr/bin/env bash
set -exu

# TODO: https://devcenter.heroku.com/articles/rails-4-asset-pipeline#dependencies-improperly-used

# ENV
export RAILS_ENV=production
export RAILS_LOG_LEVEL=debug
export DISABLE_SECRETS_STRENGTH_CHECK=true

export PATH=$(pwd)/vendor/jruby/bin/:$(ruby -e "puts ENV['PATH'].split(':').reject{|s| s.match(/\.rbenv/)}.join(':')")

# precompilation: js, css, fonts, images
jruby --dev -S bundle exec rake assets:precompile
# cleanup obsoletes
jruby --dev -S bundle exec rake assets:clean[0]

# build locale files
bin/translation-csv-to-locale-yamls
