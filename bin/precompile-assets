 #!/usr/bin/env bash
set -euo pipefail

PROJECT_DIR="$(cd -- "$(dirname "${BASH_SOURCE}")" ; cd .. > /dev/null 2>&1 && pwd -P)"
cd $PROJECT_DIR

./bin/env/ruby-setup --quiet
./bin/env/nodejs-setup

export RAILS_ENV=production
export RAILS_LOG_LEVEL=debug
export DISABLE_SECRETS_STRENGTH_CHECK=true

# build locale files
bin/translation-csv-to-locale-yamls

# bundle js
npm run -s build

# precompilation: js, css, fonts, images
bundle exec rake assets:precompile

# cleanup obsoletes
bundle exec rake assets:clean
